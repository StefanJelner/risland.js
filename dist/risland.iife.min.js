/**
 * @license
 * author: Stefan Jelner
 * risland.js v0.0.1
 * Released under the ISC license.
 * 
 * See https://github.com/StefanJelner/risland.js.git
 */
var RIsland=function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)},r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,Object.prototype.toString),n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var n,a=e(t);if("boolean"===a)return"boolean";if("string"===a)return"string";if("number"===a)return"number";if("symbol"===a)return"symbol";if("function"===a)return n=t,"GeneratorFunction"===o(n)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(t))return"array";if(function(e){if(e.constructor&&"function"==typeof e.constructor.isBuffer)return e.constructor.isBuffer(e);return!1}
/*!
   * shallow-clone <https://github.com/jonschlinkert/shallow-clone>
   *
   * Copyright (c) 2015-present, Jon Schlinkert.
   * Released under the MIT License.
   */(t))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(t))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(t))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(t))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(t))return"regexp";switch(o(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(t))return"generator";switch(a=r.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return a.slice(8,-1).toLowerCase().replace(/\s/g,"")};function o(e){return"function"==typeof e.constructor?e.constructor.name:null}var a=Symbol.prototype.valueOf,i=n;var c=function(t){return null!=t&&"object"===e(t)&&!1===Array.isArray(t)};function u(e){return!0===c(e)&&"[object Object]"===Object.prototype.toString.call(e)}var s=function(e,t){switch(i(e)){case"array":return e.slice();case"object":return Object.assign({},e);case"date":return new e.constructor(Number(e));case"map":return new Map(e);case"set":return new Set(e);case"buffer":return function(e){var t=e.length,r=Buffer.allocUnsafe?Buffer.allocUnsafe(t):Buffer.from(t);return e.copy(r),r}(e);case"symbol":return function(e){return a?Object(a.call(e)):{}}(e);case"arraybuffer":return function(e){var t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}(e);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return function(e,t){return new e.constructor(e.buffer,e.byteOffset,e.length)}(e);case"regexp":return function(e){var t=void 0!==e.flags?e.flags:/\w+$/.exec(e)||void 0,r=new e.constructor(e.source,t);return r.lastIndex=e.lastIndex,r}(e);case"error":return Object.create(e);default:return e}},l=n,f=function(e){var t,r;return!1!==u(e)&&("function"==typeof(t=e.constructor)&&(!1!==u(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))};function d(e,t){switch(l(e)){case"object":return function(e,t){if("function"==typeof t)return t(e);if(t||f(e)){var r=new e.constructor;for(var n in e)r[n]=d(e[n],t);return r}return e}(e,t);case"array":return function(e,t){for(var r=new e.constructor(e.length),n=0;n<e.length;n++)r[n]=d(e[n],t);return r}(e,t);default:return s(e)}}var p=d,h=function(t){return function(t){return!!t&&"object"===e(t)}(t)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===g}(e)}(t)};var g="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function m(e,t){return!1!==t.clone&&t.isMergeableObject(e)?x((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function y(e,t,r){return e.concat(t).map((function(e){return m(e,r)}))}function v(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function b(e,t){try{return t in e}catch(e){return!1}}function _(e,t,r){var n={};return r.isMergeableObject(e)&&v(e).forEach((function(t){n[t]=m(e[t],r)})),v(t).forEach((function(o){(function(e,t){return b(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,o)||(b(e,o)&&r.isMergeableObject(t[o])?n[o]=function(e,t){if(!t.customMerge)return x;var r=t.customMerge(e);return"function"==typeof r?r:x}(o,r)(e[o],t[o],r):n[o]=m(t[o],r))})),n}function x(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||y,r.isMergeableObject=r.isMergeableObject||h,r.cloneUnlessOtherwiseSpecified=m;var n=Array.isArray(t);return n===Array.isArray(e)?n?r.arrayMerge(e,t,r):_(e,t,r):m(t,r)}x.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return x(e,r,t)}),{})};var w=x,A=function t(r,n){if(r===n)return!0;if(r&&n&&"object"==e(r)&&"object"==e(n)){if(r.constructor!==n.constructor)return!1;var o,a,i;if(Array.isArray(r)){if((o=r.length)!=n.length)return!1;for(a=o;0!=a--;)if(!t(r[a],n[a]))return!1;return!0}if(r.constructor===RegExp)return r.source===n.source&&r.flags===n.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===n.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===n.toString();if((o=(i=Object.keys(r)).length)!==Object.keys(n).length)return!1;for(a=o;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;for(a=o;0!=a--;){var c=i[a];if(!t(r[c],n[c]))return!1}return!0}return r!=r&&n!=n};
/*!
   * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   */
function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function S(e){var t,r;return!1!==O(e)&&(void 0===(t=e.constructor)||!1!==O(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf"))}var N;var j="undefined"==typeof document?void 0:document,E=!!j&&"content"in j.createElement("template"),T=!!j&&j.createRange&&"createContextualFragment"in j.createRange();function C(e){return e=e.trim(),E?function(e){var t=j.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(e):T?function(e){return N||(N=j.createRange()).selectNode(j.body),N.createContextualFragment(e).childNodes[0]}(e):function(e){var t=j.createElement("body");return t.innerHTML=e,t.childNodes[0]}(e)}function I(e,t){var r,n,o=e.nodeName,a=t.nodeName;return o===a||(r=o.charCodeAt(0),n=a.charCodeAt(0),r<=90&&n>=97?o===a.toUpperCase():n<=90&&r>=97&&a===o.toUpperCase())}function U(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r))}var F={OPTION:function(e,t){var r=e.parentNode;if(r){var n=r.nodeName.toUpperCase();"OPTGROUP"===n&&(n=(r=r.parentNode)&&r.nodeName.toUpperCase()),"SELECT"!==n||r.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),r.selectedIndex=-1)}U(e,t,"selected")},INPUT:function(e,t){U(e,t,"checked"),U(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var n=e.firstChild;if(n){var o=n.nodeValue;if(o==r||!r&&o==e.placeholder)return;n.nodeValue=r}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var r,n,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(n=i.nodeName&&i.nodeName.toUpperCase()))i=(r=i).firstChild;else{if("OPTION"===n){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&r&&(i=r.nextSibling,r=null)}e.selectedIndex=o}}};function R(){}function P(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var M=function(e){return function(t,r,n){if(n||(n={}),"string"==typeof r)if("#document"===t.nodeName||"HTML"===t.nodeName||"BODY"===t.nodeName){var o=r;(r=j.createElement("html")).innerHTML=o}else r=C(r);var a=n.getNodeKey||P,i=n.onBeforeNodeAdded||R,c=n.onNodeAdded||R,u=n.onBeforeElUpdated||R,s=n.onElUpdated||R,l=n.onBeforeNodeDiscarded||R,f=n.onNodeDiscarded||R,d=n.onBeforeElChildrenUpdated||R,p=!0===n.childrenOnly,h=Object.create(null),g=[];function m(e){g.push(e)}function y(e,t){if(1===e.nodeType)for(var r=e.firstChild;r;){var n=void 0;t&&(n=a(r))?m(n):(f(r),r.firstChild&&y(r,t)),r=r.nextSibling}}function v(e,t,r){!1!==l(e)&&(t&&t.removeChild(e),f(e),y(e,r))}function b(e){c(e);for(var t=e.firstChild;t;){var r=t.nextSibling,n=a(t);if(n){var o=h[n];o&&I(t,o)?(t.parentNode.replaceChild(o,t),_(o,t)):b(t)}else b(t);t=r}}function _(t,r,n){var o=a(r);if(o&&delete h[o],!n){if(!1===u(t,r))return;if(e(t,r),s(t),!1===d(t,r))return}"TEXTAREA"!==t.nodeName?function(e,t){var r,n,o,c,u,s=t.firstChild,l=e.firstChild;e:for(;s;){for(c=s.nextSibling,r=a(s);l;){if(o=l.nextSibling,s.isSameNode&&s.isSameNode(l)){s=c,l=o;continue e}n=a(l);var f=l.nodeType,d=void 0;if(f===s.nodeType&&(1===f?(r?r!==n&&((u=h[r])?o===u?d=!1:(e.insertBefore(u,l),n?m(n):v(l,e,!0),l=u):d=!1):n&&(d=!1),(d=!1!==d&&I(l,s))&&_(l,s)):3!==f&&8!=f||(d=!0,l.nodeValue!==s.nodeValue&&(l.nodeValue=s.nodeValue))),d){s=c,l=o;continue e}n?m(n):v(l,e,!0),l=o}if(r&&(u=h[r])&&I(u,s))e.appendChild(u),_(u,s);else{var p=i(s);!1!==p&&(p&&(s=p),s.actualize&&(s=s.actualize(e.ownerDocument||j)),e.appendChild(s),b(s))}s=c,l=o}!function(e,t,r){for(;t;){var n=t.nextSibling;(r=a(t))?m(r):v(t,e,!0),t=n}}(e,l,n);var g=F[e.nodeName];g&&g(e,t)}(t,r):F.TEXTAREA(t,r)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var r=t.firstChild;r;){var n=a(r);n&&(h[n]=r),e(r),r=r.nextSibling}}(t);var x,w,A=t,O=A.nodeType,S=r.nodeType;if(!p)if(1===O)1===S?I(t,r)||(f(t),A=function(e,t){for(var r=e.firstChild;r;){var n=r.nextSibling;t.appendChild(r),r=n}return t}(t,(x=r.nodeName,(w=r.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==w?j.createElementNS(w,x):j.createElement(x)))):A=r;else if(3===O||8===O){if(S===O)return A.nodeValue!==r.nodeValue&&(A.nodeValue=r.nodeValue),A;A=r}if(A===r)f(t);else{if(r.isSameNode&&r.isSameNode(A))return;if(_(A,r,p),g)for(var N=0,E=g.length;N<E;N++){var T=h[g[N]];T&&v(T,T.parentNode,!1)}}return!p&&A!==t&&t.parentNode&&(A.actualize&&(A=A.actualize(t.ownerDocument||j)),t.parentNode.replaceChild(A,t)),A}}((function(e,t){var r,n,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var c=i.length-1;c>=0;c--)n=(r=i[c]).name,o=r.namespaceURI,a=r.value,o?(n=r.localName||n,e.getAttributeNS(o,n)!==a&&("xmlns"===r.prefix&&(n=r.name),e.setAttributeNS(o,n,a))):e.getAttribute(n)!==a&&e.setAttribute(n,a);for(var u=e.attributes,s=u.length-1;s>=0;s--)n=(r=u[s]).name,(o=r.namespaceURI)?(n=r.localName||n,t.hasAttributeNS(o,n)||e.removeAttributeNS(o,n)):t.hasAttribute(n)||e.removeAttribute(n)}})),k=function(e){var t,r=null,n=function(n){return function(){r=null,e.apply(n,t)}},o=function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];t=o,null===r&&(r=requestAnimationFrame(n(this)))};return o.cancel=function(){cancelAnimationFrame(r),r=null},o},L={exports:{}};(function(t){function r(e){var t,n,o=new Error(e);return t=o,n=r.prototype,Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n,o}function n(e,t,n){var o=t.slice(0,n).split(/\n/),a=o.length,i=o[a-1].length+1;throw r(e+=" at line "+a+" col "+i+":\n\n  "+t.split(/\n/)[a-1]+"\n  "+Array(i).join(" ")+"^")}r.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var o=new Function("return this")().Promise,a=!1;try{a=new Function("return (async function(){}).constructor")()}catch(t){if(!(t instanceof SyntaxError))throw t}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(t,r,n){for(var o in r)i(r,o)&&(null==r[o]||"object"!=e(r[o])||"storage"!==o&&"prefixes"!==o||n?t[o]=r[o]:t[o]=c({},r[o]));return t}var u=/^async +/,s=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,l=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,f=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g,d=/[.*+\-?^${}()|[\]\\]/g;function p(e){return d.test(e)?e.replace(d,"\\$&"):e}function h(e,t){t.rmWhitespace&&(e=e.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),s.lastIndex=0,l.lastIndex=0,f.lastIndex=0;var o=t.prefixes,a=[o.h,o.b,o.i,o.r,o.c,o.e].reduce((function(e,t){return e&&t?e+"|"+p(t):t?p(t):e}),""),i=new RegExp("([|()]|=>)|('|\"|`|\\/\\*)|\\s*((\\/)?(-|_)?"+p(t.tags[1])+")","g"),c=new RegExp("([^]*?)"+p(t.tags[0])+"(-|_)?\\s*("+a+")?\\s*","g"),d=0,h=!1;function g(r,o){var a,p={f:[]},g=0,m="c";function y(r){var o=e.slice(d,r),a=o.trim();if("f"===m)"safe"===a?p.raw=!0:t.async&&u.test(a)?(a=a.replace(u,""),p.f.push([a,"",!0])):p.f.push([a,""]);else if("fp"===m)p.f[p.f.length-1][1]+=a;else if("err"===m){if(a){var i=o.search(/\S/);n("invalid syntax",e,d+i)}}else p[m]=a;d=r+1}for("h"===o||"b"===o||"c"===o?m="n":"r"===o&&(p.raw=!0,o="i"),i.lastIndex=d;null!==(a=i.exec(e));){var v=a[1],b=a[2],_=a[3],x=a[4],w=a[5],A=a.index;if(v)"("===v?(0===g&&("n"===m?(y(A),m="p"):"f"===m&&(y(A),m="fp")),g++):")"===v?0==--g&&"c"!==m&&(y(A),m="err"):0===g&&"|"===v?(y(A),m="f"):"=>"===v&&(y(A),d+=1,m="res");else if(b)if("/*"===b){var O=e.indexOf("*/",i.lastIndex);-1===O&&n("unclosed comment",e,a.index),i.lastIndex=O+2}else"'"===b?(l.lastIndex=a.index,l.exec(e)?i.lastIndex=l.lastIndex:n("unclosed string",e,a.index)):'"'===b?(f.lastIndex=a.index,f.exec(e)?i.lastIndex=f.lastIndex:n("unclosed string",e,a.index)):"`"===b&&(s.lastIndex=a.index,s.exec(e)?i.lastIndex=s.lastIndex:n("unclosed string",e,a.index));else if(_)return y(A),d=A+a[0].length,c.lastIndex=d,h=w,x&&"h"===o&&(o="s"),p.t=o,p}return n("unclosed tag",e,r),p}var m=function a(i,s){i.b=[],i.d=[];var l,f=!1,p=[];function m(e,r){e&&(e=function(e,t,r,n){var o,a;return"string"==typeof t.autoTrim?o=a=t.autoTrim:Array.isArray(t.autoTrim)&&(o=t.autoTrim[1],a=t.autoTrim[0]),(r||!1===r)&&(o=r),(n||!1===n)&&(a=n),"slurp"===o&&"slurp"===a?e.trim():("_"===o||"slurp"===o?e=String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):"-"!==o&&"nl"!==o||(e=e.replace(/^(?:\n|\r|\r\n)/,"")),"_"===a||"slurp"===a?e=String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):"-"!==a&&"nl"!==a||(e=e.replace(/(?:\n|\r|\r\n)$/,"")),e)}(e,t,h,r))&&(e=e.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),p.push(e))}for(;null!==(l=c.exec(e));){var y,v=l[1],b=l[2],_=l[3]||"";for(var x in o)if(o[x]===_){y=x;break}m(v,b),d=l.index+l[0].length,y||n("unrecognized tag type: "+_,e,d);var w=g(l.index,y),A=w.t;if("h"===A){var O=w.n||"";t.async&&u.test(O)&&(w.a=!0,w.n=O.replace(u,"")),w=a(w),p.push(w)}else if("c"===A){if(i.n===w.n)return f?(f.d=p,i.b.push(f)):i.d=p,i;n("Helper start and end don't match",e,l.index+l[0].length)}else if("b"===A){f?(f.d=p,i.b.push(f)):i.d=p;var S=w.n||"";t.async&&u.test(S)&&(w.a=!0,w.n=S.replace(u,"")),f=w,p=[]}else if("s"===A){var N=w.n||"";t.async&&u.test(N)&&(w.a=!0,w.n=N.replace(u,"")),p.push(w)}else p.push(w)}if(!s)throw r('unclosed helper "'+i.n+'"');return m(e.slice(d,e.length),!1),i.d=p,i}({f:[]},!0);if(t.plugins)for(var y=0;y<t.plugins.length;y++){var v=t.plugins[y];v.processAST&&(m.d=v.processAST(m.d,t))}return m.d}function g(e,t){var r=h(e,t),n="var tR='';"+(t.useWith?"with("+t.varName+"||{}){":"")+_(r,t)+"if(cb){cb(null,tR)} return tR"+(t.useWith?"}":"");if(t.plugins)for(var o=0;o<t.plugins.length;o++){var a=t.plugins[o];a.processFnString&&(n=a.processFnString(n,t))}return n}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r][0],o=t[r][1];e=(t[r][2]?"await ":"")+"c.l('F','"+n+"')("+e,o&&(e+=","+o),e+=")"}return e}function y(e,t,r,n,o,a){var i="{exec:"+(o?"async ":"")+b(r,t,e)+",params:["+n+"]";return a&&(i+=",name:'"+a+"'"),o&&(i+=",async:true"),i+"}"}function v(e,t){for(var r="[",n=0;n<e.length;n++){var o=e[n];r+=y(t,o.res||"",o.d,o.p||"",o.a,o.n),n<e.length&&(r+=",")}return r+"]"}function b(e,t,r){return"function("+t+"){var tR='';"+_(e,r)+"return tR}"}function _(e,t){for(var r=0,n=e.length,o="";r<n;r++){var a=e[r];if("string"==typeof a)o+="tR+='"+a+"';";else{var i=a.t,c=a.c||"",u=a.f,s=a.n||"",l=a.p||"",f=a.res||"",d=a.b,p=!!a.a;if("i"===i){t.defaultFilter&&(c="c.l('F','"+t.defaultFilter+"')("+c+")");var h=m(c,u);!a.raw&&t.autoEscape&&(h="c.l('F','e')("+h+")"),o+="tR+="+h+";"}else if("h"===i)if(t.storage.nativeHelpers.get(s))o+=t.storage.nativeHelpers.get(s)(a,t);else{var g=(p?"await ":"")+"c.l('H','"+s+"')("+y(t,f,a.d,l,p);g+=d?","+v(d,t):",[]",o+="tR+="+m(g+=",c)",u)+";"}else"s"===i?o+="tR+="+m((p?"await ":"")+"c.l('H','"+s+"')({params:["+l+"]},[],c)",u)+";":"e"===i&&(o+=c+"\n")}}return o}var x=function(){function e(e){this.cache=e}return e.prototype.define=function(e,t){this.cache[e]=t},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.reset=function(){this.cache={}},e.prototype.load=function(e){c(this.cache,e,!0)},e}();function w(e,t,n,o){if(t&&t.length>0)throw r((o?"Native":"")+"Helper '"+e+"' doesn't accept blocks");if(n&&n.length>0)throw r((o?"Native":"")+"Helper '"+e+"' doesn't accept filters")}var A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function O(e){return A[e]}var S=new x({}),N=new x({each:function(e,t){var r="",n=e.params[0];if(w("each",t,!1),e.async)return new Promise((function(t){!function e(t,r,n,o,a){n(t[r],r).then((function(i){o+=i,r===t.length-1?a(o):e(t,r+1,n,o,a)}))}(n,0,e.exec,r,t)}));for(var o=0;o<n.length;o++)r+=e.exec(n[o],o);return r},foreach:function(e,t){var r=e.params[0];if(w("foreach",t,!1),e.async)return new Promise((function(t){!function e(t,r,n,o,a,i){o(r[n],t[r[n]]).then((function(c){a+=c,n===r.length-1?i(a):e(t,r,n+1,o,a,i)}))}(r,Object.keys(r),0,e.exec,"",t)}));var n="";for(var o in r)i(r,o)&&(n+=e.exec(o,r[o]));return n},include:function(e,t,n){w("include",t,!1);var o=n.storage.templates.get(e.params[0]);if(!o)throw r('Could not fetch template "'+e.params[0]+'"');return o(e.params[1],n)},extends:function(e,t,n){var o=e.params[1]||{};o.content=e.exec();for(var a=0;a<t.length;a++){var i=t[a];o[i.name]=i.exec()}var c=n.storage.templates.get(e.params[0]);if(!c)throw r('Could not fetch template "'+e.params[0]+'"');return c(o,n)},useScope:function(e,t){return w("useScope",t,!1),e.exec(e.params[0])}}),j=new x({if:function(e,t){w("if",!1,e.f,!0);var r="if("+e.p+"){"+_(e.d,t)+"}";if(e.b)for(var n=0;n<e.b.length;n++){var o=e.b[n];"else"===o.n?r+="else{"+_(o.d,t)+"}":"elif"===o.n&&(r+="else if("+o.p+"){"+_(o.d,t)+"}")}return r},try:function(e,t){if(w("try",!1,e.f,!0),!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw r("native helper 'try' only accepts 1 block, 'catch'");var n="try{"+_(e.d,t)+"}",o=e.b[0];return n+"catch"+(o.res?"("+o.res+")":"")+"{"+_(o.d,t)+"}"},block:function(e,t){return w("block",e.b,e.f,!0),"if(!"+t.varName+"["+e.p+"]){tR+=("+b(e.d,"",t)+")()}else{tR+="+t.varName+"["+e.p+"]}"}}),E=new x({e:function(e){var t=String(e);return/[&<>"']/.test(t)?t.replace(/[&<>"']/g,O):t}}),T={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(e,t){if("H"===e){var n=this.storage.helpers.get(t);if(n)return n;throw r("Can't find helper '"+t+"'")}if("F"===e){var o=this.storage.filters.get(t);if(o)return o;throw r("Can't find filter '"+t+"'")}},async:!1,storage:{helpers:N,nativeHelpers:j,filters:E,templates:S},prefixes:{h:"@",b:"#",i:"",r:"*",c:"/",e:"!"},cache:!1,plugins:[],useWith:!1};function C(e,t){var r={};return c(r,T),t&&c(r,t),e&&c(r,e),r.l.bind(r),r}function I(e,t){var n=C(t||{}),o=Function;if(n.async){if(!a)throw r("This environment doesn't support async/await");o=a}try{return new o(n.varName,"c","cb",g(e,n))}catch(t){throw t instanceof SyntaxError?r("Bad template syntax\n\n"+t.message+"\n"+Array(t.message.length+1).join("=")+"\n"+g(e,n)):t}}function U(e,t){var r;return t.cache&&t.name&&t.storage.templates.get(t.name)?t.storage.templates.get(t.name):(r="function"==typeof e?e:I(e,t),t.cache&&t.name&&t.storage.templates.define(t.name,r),r)}T.l.bind(T),t.compile=I,t.compileScope=_,t.compileScopeIntoFunction=b,t.compileToString=g,t.defaultConfig=T,t.filters=E,t.getConfig=C,t.helpers=N,t.nativeHelpers=j,t.parse=h,t.render=function(e,t,n,a){var i=C(n||{});if(!i.async)return U(e,i)(t,i);if(!a){if("function"==typeof o)return new o((function(r,n){try{r(U(e,i)(t,i))}catch(e){n(e)}}));throw r("Please provide a callback function, this env doesn't support Promises")}try{U(e,i)(t,i,a)}catch(e){return a(e)}},t.templates=S,Object.defineProperty(t,"__esModule",{value:!0})})(L.exports);var H={};function $(e,t,r,n){var o,a=!1,i=0;function c(){o&&clearTimeout(o)}function u(){for(var u=arguments.length,s=new Array(u),l=0;l<u;l++)s[l]=arguments[l];var f=this,d=Date.now()-i;function p(){i=Date.now(),r.apply(f,s)}function h(){o=void 0}a||(n&&!o&&p(),c(),void 0===n&&d>e?p():!0!==t&&(o=setTimeout(n?h:p,void 0===n?e-d:e)))}return"boolean"!=typeof t&&(n=r,r=t,t=void 0),u.cancel=function(){c(),a=!0},u}Object.defineProperty(H,"__esModule",{value:!0}),H.debounce=function(e,t,r){return void 0===r?$(e,t,!1):$(e,r,!1!==t)};var D=H.throttle=$;return function(){function r(e){var r=this;this._initialConfig={$element:document.body,deepmerge:{isMergeableObject:S},delegations:{},initialState:{},load:function(){},morphdom:{onBeforeElUpdated:function(e,t){return!e.isEqualNode(t)}},nonBubblingEvents:["abort","blur","error","focus","load","loadend","loadstart","pointerenter","pointerleave","progress","scroll","unload"],shouldUpdate:function(e,t){return!A(e,t)},squirrelly:L.exports.defaultConfig,template:"",unload:function(){},update:function(){}},this._enforcedConfig={deepmerge:{clone:!1},morphdom:{childrenOnly:!1},squirrelly:{varName:"state"}},this._delegationFuncs={},this._loaded=!1,this._throttledLoadOrUpdate=k(this._loadOrUpdate),this._throttledRender=k(this._render),this._config=w.all([this._initialConfig,p(e),this._enforcedConfig],t(t({},this._initialConfig.deepmerge),this._enforcedConfig.deepmerge)),this._compiledTemplate=L.exports.compile(this._getTemplate(this._config.template),this._config.squirrelly),this._setState(this._config.initialState),Object.keys(this._config.delegations).forEach((function(e){var t=r._getThrottling(e);r._delegationFuncs[e]={capture:-1!==r._config.nonBubblingEvents.indexOf(t.eventName),func:function(t){t.target instanceof HTMLElement&&Object.keys(r._config.delegations[e]).forEach((function(n){null!==t.target.closest(n)&&r._config.delegations[e][n](t,p(r._state),r._setState.bind(r))}))}},!0===t.throttled&&(r._delegationFuncs[e].func="ms"in t?D(t.ms,r._delegationFuncs[e].func):k(r._delegationFuncs[e].func)),r._config.$element.addEventListener(t.eventName,r._delegationFuncs[e].func,{capture:r._delegationFuncs[e].capture})}))}return r.prototype.unload=function(){var e=this;Object.keys(this._config.delegations).forEach((function(t){e._config.$element.removeEventListener(t,e._delegationFuncs[t].func,{capture:e._delegationFuncs[t].capture})})),this._config.$element.innerHTML="",this._config.unload(p(this._state))},r.prototype._setState=function(e){var t=this,r="function"==typeof e?e(p(this._state)):e;if(null!==r)if(r instanceof Promise)r.then((function(e){return t._setState(e)}));else if(Array.isArray(r))r.forEach((function(e){return t._setState(e)}));else{var n="customMerge"in this._config.deepmerge?w(p(this._state),r,this._config.deepmerge):w(this._state,r,this._config.deepmerge),o=this._config.shouldUpdate===this._initialConfig.shouldUpdate?this._config.shouldUpdate(this._state,n):this._config.shouldUpdate(p(this._state),"customMerge"in this._config.deepmerge?n:p(n));this._state=n,!0===o&&this._throttledRender()}},r.prototype._render=function(){var e=this;null===this._config.$element.firstChild&&this._config.$element.appendChild(document.createElement("div")),M(this._config.$element.firstChild,this._compiledTemplate(this._state,this._config.squirrelly),t(t({},this._config.morphdom),{onElUpdated:function(t){e._throttledLoadOrUpdate(),"onElUpdated"in e._config.morphdom&&e._config.morphdom.onElUpdated(t)},onNodeAdded:function(t){return e._throttledLoadOrUpdate(),"onNodeAdded"in e._config.morphdom?e._config.morphdom.onNodeAdded(t):t},onNodeDiscarded:function(t){return e._throttledLoadOrUpdate(),"onNodeDiscarded"in e._config.morphdom?e._config.morphdom.onNodeDiscarded(t):t}}))},r.prototype._getTemplate=function(t){if("string"==typeof t)return t;if("object"===e(t)&&"content"in t&&t.content instanceof DocumentFragment){if(!1===this._checkWrapping(t.content)){var r="RIsland: First element in the template must be a single element, without any siblings. The content should at least be wrapped in a div-tag.";return console.error(r),'<p style="color:red;">'.concat(r,"</p>")}var n=document.createElement("textarea");return n.innerHTML=Array.from(t.content.childNodes).map((function(e){return e.outerHTML})).join(""),n.value}var o="RIsland: template must be a string or a template tag element.";return console.error(o),'<p style="color:red;">'.concat(o,"</p>")},r.prototype._checkWrapping=function(e){return 1===Array.from(e.childNodes).filter((function(e){return e instanceof Element})).length},r.prototype._getThrottling=function(e){var t=e.split(/\./g),r=t[0];if(t.length>1&&"throttled"===t[1]){if(3===t.length){var n=parseInt(t[2],10);if(!isNaN(n))return{eventName:r,ms:n,throttled:!0};console.warn('RIsland: event name "'.concat(e,'" is malformed. The milliseconds "').concat(t[2],'" are not a valid number. falling back to request animation frame.'))}return{eventName:r,throttled:!0}}return{eventName:r,throttled:!1}},r.prototype._loadOrUpdate=function(){var e=p(this._state);!1===this._loaded?(this._loaded=!0,this._config.load(e,this._setState.bind(this))):this._config.update(e,this._setState.bind(this))},r}()}();
